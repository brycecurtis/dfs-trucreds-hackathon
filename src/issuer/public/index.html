<html>
<head>
	<script>
		let socket = new WebSocket("ws://localhost:3000/");
		
		function updateDiv(id, data) {
			const div = document.getElementById(id)
			const html = div.innerHTML + "<br/>" + data;
			div.innerHTML = html;
		}

		function wsInit() {
			socket.onopen = function(e) {
				console.log("[open] Connection established");
				socket.send("Client connected");
				socket.send("info");
			};

			socket.onmessage = function(event) {
				console.log(`[message] Data received from server: ${event.data}`);
				const data = JSON.parse(event.data);
				if (data.type == "info") {
					console.log(JSON.stringify(data.data,null,4));
					updateDiv("info", "<pre>"+JSON.stringify(data.data,null,4)+"</pre>")
				}
				else {
					updateDiv("log", event.data);
				}
			};

			socket.onclose = function(event) {
				if (event.wasClean) {
					console.log(`[close] Connection closed cleanly, code=${event.code} reason=${event.reason}`);
				} else {
					// e.g. server process killed or network down
					// event.code is usually 1006 in this case
					console.log('[close] Connection died');
				}
			};

			socket.onerror = function(error) {
				console.log(`[error] ${error.message}`);
			};
		}
	</script>
</head>

<body>
	<h1>Sample Issuer</h1>
	<table>
		<tr><td>
	<p>Scan QR code to get a credential.</p>
	<img src="/qrcode.png"/>
	</td><td>
	<h2>Issuer Info</h2>
	<div id="info"></div>
	</td></tr>
	</table>
	<h2>Logs</h2>
	<div id="log"></div>

	<script>
		wsInit();
	</script>
</body>
</html>